;
(self.AMP=self.AMP||[]).push({m:1,v:"2310301456000",n:"amp-image-lightbox",ev:"0.1",l:!0,f:function(t,i){(()=>{var i;function s(){return i||(i=Promise.resolve(void 0))}var h=class{constructor(){this.promise=new Promise(((t,i)=>{this.resolve=t,this.reject=i}))}},{isArray:n}=Array;function e(t,i){const s=[];let h=0;for(let n=0;n<t.length;n++){const e=t[n];i(e,n,t)?s.push(e):(h<n&&(t[h]=e),h++)}return h<t.length&&(t.length=h),s}function r(t){return"string"==typeof t}var{hasOwnProperty:o,toString:a}=Object.prototype;function c(t,i,s,h){return n=>u.solveYValueFromXValue(n,0,0,t,i,s,h,1,1)}var u=class t{static solveYValueFromXValue(i,s,h,n,e,r,o,a,c){return t.Qr(t.Xr(i,s,n,r,a),h,e,o,c)}static Xr(i,s,h,n,e){const r=1e-6;let o=(i-s)/(e-s);if(o<=0)return 0;if(o>=1)return 1;let a=0,c=1,u=0;for(let l=0;l<8;l++){u=t.Zr(o,s,h,n,e);const l=(t.Zr(o+r,s,h,n,e)-u)/r;if(Math.abs(u-i)<r)return o;if(Math.abs(l)<r)break;u<i?a=o:c=o,o-=(u-i)/l}for(let l=0;Math.abs(u-i)>r&&l<8;l++)u<i?(a=o,o=(o+c)/2):(c=o,o=(o+a)/2),u=t.Zr(o,s,h,n,e);return o}static Zr(i,s,h,n,e){if(0==i)return s;if(1==i)return e;let r=t.th(s,h,i),o=t.th(h,n,i);const a=t.th(n,e,i);return r=t.th(r,o,i),o=t.th(o,a,i),t.th(r,o,i)}static Qr(i,s,h,n,e){if(0==i)return s;if(1==i)return e;let r=t.th(s,h,i),o=t.th(h,n,i);const a=t.th(n,e,i);return r=t.th(r,o,i),o=t.th(o,a,i),t.th(r,o,i)}static th(t,i,s){return t+s*(i-t)}},l={LINEAR:t=>t,EASE:t=>u.solveYValueFromXValue(t,0,0,.25,.1,.25,1,1,1),EASE_IN:t=>u.solveYValueFromXValue(t,0,0,.42,0,1,1,1,1),EASE_OUT:t=>u.solveYValueFromXValue(t,0,0,0,0,.58,1,1,1),EASE_IN_OUT:t=>u.solveYValueFromXValue(t,0,0,.42,0,.58,1,1,1)},f={"linear":l.LINEAR,"ease":l.EASE,"ease-in":l.EASE_IN,"ease-out":l.EASE_OUT,"ease-in-out":l.EASE_IN_OUT};function m(t){if(!t)return null;if(r(t)){if(-1!=t.indexOf("cubic-bezier")){const i=t.match(/cubic-bezier\((.+)\)/);if(i){const t=i[1].split(",").map(parseFloat);if(4==t.length){for(let i=0;i<4;i++)if(isNaN(t[i]))return null;return c(t[0],t[1],t[2],t[3])}}return null}return f[t]}return t}function d(t){return 1==(null==(i=t)?void 0:i.nodeType)?t.tagName.toLowerCase()+(t.id?`#${t.id}`:""):t;var i}function _(t,i,s,h,n,e,r,o,a,c,u){return t}function p(t,i,s,h,n,r,o,a,c,u,l){return function(t,i,s="Assertion failed",h){var n,r;if(i)return i;t&&-1==s.indexOf(t)&&(s+=t);let o=3;const a=s.split("%s");let c=a.shift();const u=[c];for(;a.length;){const t=arguments[o++],i=a.shift();c+=d(t)+i,u.push(t,i.trim())}const l=new Error(c);throw l.messageArray=e(u,(t=>""!==t)),null===(n=(r=self).__AMP_REPORT_ERROR)||void 0===n||n.call(r,l),l}("​​​",t,i,s,h,n,r,o,a,c,u,l)}function g(t){return(t.ownerDocument||t).defaultView}function A(t){_(/^[\w-]+$/.test(t))}function M(t,i,s,h){return{left:t,top:i,width:s,height:h,bottom:i+h,right:t+s,x:t,y:i}}function P(t){return M(Number(t.left),Number(t.top),Number(t.width),Number(t.height))}function v(t,i,s,h){const e=n(r=t)?r:[r];var r;for(const t of e){const n=i.getAttribute(t);null!==n?s.setAttribute(t,n):h&&s.removeAttribute(t)}}var E,b=/(\S+)(?:\s+(?:(-?\d+(?:\.\d+)?)([a-zA-Z]*)))?\s*(?:,|$)/g,T=class{constructor(t){p(t.length>0,"Srcset must have at least one source"),this.aw=t;let i=!1,s=!1;for(let h=0;h<t.length;h++){const n=t[h];i=i||!!n.width,s=s||!!n.dpr}p(!(i===s),"Srcset must have width or dpr sources, but not both"),t.sort(i?I:R),this.cw=i}select(t,i){_(t),_(i);let s=0;return s=this.cw?this.fw(t*i):this.pw(i),this.aw[s].url}fw(t){const i=this.aw;let s=0,h=1/0,n=1/0;for(let r=0;r<i.length;r++){var e;const o=null!==(e=i[r].width)&&void 0!==e?e:0,a=Math.abs(o-t);if(!(a<=1.1*h||t/n>1.2))break;s=r,h=a,n=o}return s}pw(t){const i=this.aw;let s=0,h=1/0;for(let n=0;n<i.length;n++){const e=Math.abs(i[n].dpr-t);if(!(e<=h))break;s=n,h=e}return s}getUrls(){return this.aw.map((t=>t.url))}stringify(t){const i=[],s=this.aw;for(let h=0;h<s.length;h++){const n=s[h];let e=n.url;t&&(e=t(e)),this.cw?e+=` ${n.width}w`:e+=` ${n.dpr}x`,i.push(e)}return i.join(", ")}};function I(t,i){return p(t.width!=i.width,"Duplicate width: %s",t.width),t.width-i.width}function R(t,i){return p(t.dpr!=i.dpr,"Duplicate dpr: %s",t.dpr),t.dpr-i.dpr}function V(t){const i=Object.getOwnPropertyDescriptor(t,"message");if(null!=i&&i.writable)return t;const{message:s,stack:h}=t,n=new Error(s);for(const i in t)n[i]=t[i];return n.stack=h,n}function w(t){let i=null,s="";for(const t of arguments)t instanceof Error&&!i?i=V(t):(s&&(s+=" "),s+=t);return i?s&&(i.message=s+": "+i.message):i=new Error(s),i}function y(t,...i){const s=w.apply(null,i);s.name=t||s.name,function(t){var i,s;null===(i=(s=self).__AMP_REPORT_ERROR)||void 0===i||i.call(s,t)}(s)}var x=["Webkit","webkit","Moz","moz","ms","O","o"];function S(t,i,s,h,n){const e=function(t,i,s){if(i.startsWith("--"))return i;E||(E=Object.create(null));let h=E[i];if(!h||s){if(h=i,void 0===t[i]){const s=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(i),n=function(t,i){for(let s=0;s<x.length;s++){const h=x[s]+i;if(void 0!==t[h])return h}return""}(t,s);void 0!==t[n]&&(h=n)}s||(E[i]=h)}return h}(t.style,i,n);if(!e)return;const r=h?s+h:s;t.style.setProperty(function(t){const i=t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()));return x.some((t=>i.startsWith(t+"-")))?`-${i}`:i}(e),r)}function D(t,i){for(const s in i)S(t,s,i[s])}function k(t){return`${t}px`}function C(t,i){return"number"==typeof t?i(t):t}function X(t,i){return null==i?`translate(${C(t,k)})`:`translate(${C(t,k)}, ${C(i,k)})`}function O(t){return`scale(${t})`}function Y(t,i=" "){return(s,h)=>t.map((t=>t(s,h))).filter(r).join(i)}function z(t,i){return(s,h)=>{for(const e in i)S(t,("display"===(n=e)&&y("STYLE","`display` style detected. You must use toggle instead."),n),i[e](s,h));var n}}function $(t,i){return s=>t+(i-t)*s}function Z(t,i){return s=>X(t(s),null==i?void 0:i(s))}function L(t){return i=>O(t(i))}function N(t,i,s){return _(i<=s),Math.min(Math.max(t,i),s)}function B(t,i,s,h){return _(i<=s),N(t,i-h,s+h)}function U(t,i){return Math.sqrt(t*t+i*i)}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var G=self.__AMP_LOG;function F(t,i){throw new Error("failed to call initLogConstructor")}function H(t){return F()}function j(){return G.dev||(G.dev=F())}function W(t,i,s,h,n,e,r,o,a,c,u){return t}function q(t,i){return Q(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),i)}function J(t){return t.nodeType?(i=g(t),q(i,"ampdoc")).getAmpDoc(t):t;var i}function K(t){const i=J(t);return i.isSingleDoc()?i.win:i}function Q(t,i){W(tt(t,i));const s=function(t){let i=t.__AMP_SERVICES;return i||(i=t.__AMP_SERVICES={}),i}(t)[i];return s.obj||(W(s.ctor),W(s.context),s.obj=new s.ctor(s.context),W(s.obj),s.context=null,s.resolve&&s.resolve(s.obj)),s.obj}function tt(t,i){const s=t.__AMP_SERVICES&&t.__AMP_SERVICES[i];return!(!s||!s.ctor)}var it,st=t=>Q(t,"timer"),ht=t=>q(t,"vsync"),nt="Animation",et=function(){},rt=class t{static animate(i,s,h,n){return new t(i).setCurve(n).add(0,s,1).start(h)}constructor(t,i){this.ih=t,this.sh=i||ht(self),this.eh=null,this.nh=[]}setCurve(t){return t&&(this.eh=m(t)),this}add(t,i,s,h){return this.nh.push({delay:t,func:i,duration:s,curve:m(h)}),this}start(t){return new ot(this.sh,this.ih,this.nh,this.eh,t)}},ot=class{constructor(t,i,s,n,e){this.sh=t,this.ih=i,this.nh=[];for(let t=0;t<s.length;t++){const i=s[t];this.nh.push({delay:i.delay,func:i.func,duration:i.duration,curve:i.curve||n,started:!1,completed:!1})}this.rh=e,this.Dr=Date.now(),this.gn=!0,this.Mi={};const r=new h;this.hh=r.promise,this.ke=r.resolve,this.oh=r.reject,this.uh=this.sh.createAnimTask(this.ih,{mutate:this.lh.bind(this)}),this.sh.canAnimate(this.ih)?this.uh(this.Mi):this.ah(!1,0)}then(t,i){return t||i?this.hh.then(t,i):this.hh}thenAlways(t){const i=t||et;return this.then(i,i)}halt(t){this.ah(!1,t||0)}ah(t,i){if(this.gn){if(this.gn=!1,0!=i){this.nh.length>1&&this.nh.sort(((t,i)=>t.delay+t.duration-(i.delay+i.duration)));try{if(i>0)for(let t=0;t<this.nh.length;t++)this.nh[t].func(1,!0);else for(let t=this.nh.length-1;t>=0;t--)this.nh[t].func(0,!1)}catch(i){j().error(nt,"completion failed: "+i,i),t=!1}}t?this.ke():this.oh()}}lh(t){if(!this.gn)return;const i=Date.now(),s=Math.min((i-this.Dr)/this.rh,1);for(let t=0;t<this.nh.length;t++){const i=this.nh[t];!i.started&&s>=i.delay&&(i.started=!0)}for(let t=0;t<this.nh.length;t++){const i=this.nh[t];i.started&&!i.completed&&this.dh(i,s)}1==s?this.ah(!0,0):this.sh.canAnimate(this.ih)?this.uh(this.Mi):this.ah(!1,0)}dh(t,i){let s,h;if(t.duration>0){if(s=Math.min((i-t.delay)/t.duration,1),h=s,t.curve&&1!=h)try{h=t.curve(s)}catch(t){return j().error(nt,"step curve failed: "+t,t),void this.ah(!1,0)}}else s=1,h=1;1==s&&(t.completed=!0);try{t.func(h,t.completed)}catch(t){return j().error(nt,"step mutate failed: "+t,t),void this.ah(!1,0)}}};function at(t){return!!(t.complete||"complete"==t.readyState||function(t){return"AUDIO"===t.tagName||"VIDEO"===t.tagName}(t)&&t.readyState>0||t.document&&"complete"==t.document.readyState)}var ct=class{constructor(){this.Vt=null}add(t){return this.Vt||(this.Vt=[]),this.Vt.push(t),()=>{this.remove(t)}}remove(t){this.Vt&&function(t,i){const s=t.indexOf(i);-1!=s&&t.splice(s,1)}(this.Vt,t)}removeAll(){this.Vt&&(this.Vt.length=0)}fire(t){if(this.Vt)for(const i of this.Vt.slice())i(t)}getHandlerCount(){var t,i;return null!==(t=null===(i=this.Vt)||void 0===i?void 0:i.length)&&void 0!==t?t:0}},ut="__AMP_Gestures",lt=class t{static get(i,s=!1,h=!1){let n=i[ut];return n||(n=new t(i,s,h),i[ut]=n),n}constructor(t,i=!1,s=!1){this.el=t,this.Uk=[],this.t_=[],this.gi=[],this.$k=[],this.jk=null;const h=function(t){if(void 0!==it)return it;it=!1;try{const i={get passive(){return it=!0,!1}};t.addEventListener("test-options",null,i),t.removeEventListener("test-options",null,i)}catch(t){}return it}(t.ownerDocument.defaultView);this.Fk=i||h,this.Hk=s,this.Bk=!1,this.vn=new class{constructor(t,i,s){this.fn=st(t),this.pn=i,this.mn=s||0,this._n=-1,this.An=0,this.gn=!1,this.Pn=()=>{this.vn()}}isPending(){return-1!=this._n}schedule(t){let i=t||this.mn;this.gn&&i<10&&(i=10);const s=Date.now()+i;return(!this.isPending()||s-this.An<-10)&&(this.cancel(),this.An=s,this._n=this.fn.delay(this.Pn,i),!0)}vn(){this._n=-1,this.An=0,this.gn=!0,this.pn(),this.gn=!1}cancel(){this.isPending()&&(this.fn.cancel(this._n),this._n=-1)}}(g(t),this.wm.bind(this)),this.Yk=new ct,this.Gk=Object.create(null),this.Wk=this.Kf.bind(this),this.qk=this.tp.bind(this),this.Xk=this.Qf.bind(this),this.Kk=this.h_.bind(this),this.el.addEventListener("touchstart",this.Wk,!!h&&{passive:!0}),this.el.addEventListener("touchend",this.qk),this.el.addEventListener("touchmove",this.Xk,!!h&&{passive:!0}),this.el.addEventListener("touchcancel",this.Kk),this.Zk=!1}cleanup(){this.el.removeEventListener("touchstart",this.Wk),this.el.removeEventListener("touchend",this.qk),this.el.removeEventListener("touchmove",this.Xk),this.el.removeEventListener("touchcancel",this.Kk),delete this.el[ut],this.vn.cancel()}onGesture(t,i){const s=new t(this),h=s.getType();let n=this.Gk[h];return n||(this.Uk.push(s),n=new ct,this.Gk[h]=n),n.add(i)}removeGesture(t){const i=new t(this).getType(),s=this.Gk[i];if(s){s.removeAll();const t=function(t,s){for(let s=0;s<t.length;s++)if(t[s].getType()==i)return s;return-1}(this.Uk);return!(t<0||(this.Uk.splice(t,1),this.gi.splice(t,1),this.$k.splice(t,1),this.t_.splice(t,1),delete this.Gk[i],0))}return!1}onPointerDown(t){return this.Yk.add(t)}Kf(t){const i=Date.now();this.Bk=!1,this.Yk.fire(t);for(let s=0;s<this.Uk.length;s++)this.gi[s]||(this.$k[s]&&this.$k[s]<i&&this.o_(s),this.Uk[s].onTouchStart(t)&&this.u_(s));this.Jk(t)}Qf(t){const i=Date.now();for(let s=0;s<this.Uk.length;s++)this.t_[s]&&(this.$k[s]&&this.$k[s]<i?this.o_(s):this.Uk[s].onTouchMove(t)||this.o_(s));this.Jk(t)}tp(t){const i=Date.now();for(let s=0;s<this.Uk.length;s++){if(!this.t_[s])continue;if(this.$k[s]&&this.$k[s]<i){this.o_(s);continue}this.Uk[s].onTouchEnd(t);const h=!this.$k[s],n=this.$k[s]<i;this.jk==this.Uk[s]||!h&&!n||this.o_(s)}this.Jk(t)}h_(t){for(let t=0;t<this.Uk.length;t++)this.Qk(t);this.Jk(t)}Bf(t,i){if(this.jk)return void t.acceptCancel();const s=Date.now();for(let h=0;h<this.Uk.length;h++)this.Uk[h]==t&&(this.gi[h]=s+i,this.$k[h]=0);this.Zk=!0}tS(t,i){if(this.jk)return void t.acceptCancel();const s=Date.now();for(let h=0;h<this.Uk.length;h++)this.Uk[h]==t&&(this.$k[h]=s+i)}iS(t){this.jk==t&&(this.jk=null,this.Bk=!0)}sS(t,i,s){_(this.jk==t);const h=this.Gk[t.getType()];h&&h.fire(new class{constructor(t,i,s,h){this.type=t,this.data=i,this.time=s,this.event=h}}(t.getType(),i,Date.now(),s))}Jk(t){let i=!!this.jk||this.Bk;if(this.Bk=!1,!i){const t=Date.now();for(let s=0;s<this.Uk.length;s++)if(this.gi[s]||this.$k[s]&&this.$k[s]>=t){i=!0;break}}i?(t.stopPropagation(),this.Fk||t.preventDefault()):this.Hk&&t.stopPropagation(),this.Zk&&(this.Zk=!1,this.wm())}wm(){const t=Date.now();let i=-1;for(let s=0;s<this.Uk.length;s++)this.gi[s]?(-1==i||this.gi[s]>this.gi[i])&&(i=s):this.$k[s]&&this.$k[s]<t&&this.o_(s);if(-1==i)return;let s=0;for(let i=0;i<this.Uk.length;i++)!this.gi[i]&&this.t_[i]&&(s=Math.max(s,this.$k[i]-t));s<2?this.nS(i):this.vn.schedule(s)}nS(t){const i=this.Uk[t];for(let i=0;i<this.Uk.length;i++)i!=t&&this.Qk(i);this.gi[t]=0,this.$k[t]=0,this.jk=i,i.acceptStart()}u_(t){this.t_[t]=!0,this.$k[t]=0}o_(t){this.t_[t]=!1,this.$k[t]=0,this.gi[t]||this.Uk[t].acceptCancel()}Qk(t){this.gi[t]=0,this.o_(t)}},ft=class{constructor(t,i){this.jC=t,this.Rv=i}getType(){return this.jC}signalReady(t){this.Rv.Bf(this,t)}signalPending(t){this.Rv.tS(this,t)}signalEnd(){this.Rv.iS(this)}signalEmit(t,i){this.Rv.sS(this,t,i)}acceptStart(){}acceptCancel(){}onTouchStart(t){return!1}onTouchMove(t){return!1}onTouchEnd(t){}},mt=function(){},dt=.02,_t=Math.round(-16.67/Math.log(.95));function pt(t,i,s){i<1&&(i=1);const h=t/i,n=.5+Math.min(i/33.34,.5);return h*n+s*(1-n)}function gt(t,i,s,h,n,e,r){return new At(t,i,s,h,n,e,r).start()}var At=class{constructor(t,i,s,n,e,r,o){this.sh=o||ht(self),this.ih=t,this.tt=r,this.GC=i,this.WC=s,this.UX=n,this.WX=e,this.JC=0,this.QC=0;const a=new h;this.hh=a.promise,this.ke=a.resolve,this.oh=a.reject,this.FX=!1}start(){return this.FX=!0,Math.abs(this.UX)<=dt&&Math.abs(this.WX)<=dt?(this.qX(),this.JX(!0)):this.KX(),this}halt(){this.FX&&this.JX(!1)}then(t,i){return t||i?this.hh.then(t,i):this.hh}thenAlways(t){const i=t||mt;return this.then(i,i)}KX(){this.JC=this.UX,this.QC=this.WX;const t=this.QX.bind(this),i=this.JX.bind(this,!0);return this.sh.runAnimMutateSeries(this.ih,t,5e3).then(i,i)}QX(t,i){if(!this.FX)return!1;if(this.GC+=i*this.JC,this.WC+=i*this.QC,!this.qX())return!1;const s=Math.exp(-t/_t);return this.JC=this.UX*s,this.QC=this.WX*s,Math.abs(this.JC)>dt||Math.abs(this.QC)>dt}JX(t){this.FX&&(this.FX=!1,this.qX(),t?this.ke():this.oh())}qX(){return this.tt(this.GC,this.WC)}},Mt=class extends ft{constructor(t){super("tap",t),this.BC=0,this.YC=0,this.GC=0,this.WC=0,this.o=null}onTouchStart(t){const{touches:i}=t;return this.o=t.target,!(!i||1!=i.length||(this.BC=i[0].clientX,this.YC=i[0].clientY,0))}onTouchMove(t){const i=t.changedTouches||t.touches;if(i&&1==i.length){this.GC=i[0].clientX,this.WC=i[0].clientY;const t=Math.abs(this.GC-this.BC)>=8,s=Math.abs(this.WC-this.YC)>=8;if(t||s)return!1}return!0}onTouchEnd(t){this.signalReady(0)}acceptStart(){this.signalEmit({clientX:this.GC,clientY:this.WC,target:this.o},null),this.signalEnd()}},Pt=class extends ft{constructor(t){super("doubletap",t),this.BC=0,this.YC=0,this.GC=0,this.WC=0,this.MD=0,this.ED=null}onTouchStart(t){if(this.MD>1)return!1;const{touches:i}=t;return!(!i||1!=i.length||(this.BC=i[0].clientX,this.YC=i[0].clientY,this.GC=i[0].clientX,this.WC=i[0].clientY,0))}onTouchMove(t){const{touches:i}=t;if(i&&1==i.length){this.GC=i[0].clientX,this.WC=i[0].clientY;const t=Math.abs(this.GC-this.BC)>=8,s=Math.abs(this.WC-this.YC)>=8;return!t&&!s||(this.acceptCancel(),!1)}return!1}onTouchEnd(t){this.MD++,this.MD<2?this.signalPending(200):(this.ED=t,this.signalReady(0))}acceptStart(){this.MD=0,this.signalEmit({clientX:this.GC,clientY:this.WC},this.ED),this.signalEnd()}acceptCancel(){this.MD=0}},vt=class extends ft{constructor(t,i,s,h){super(t,i),this.FC=s,this.HC=h,this.jk=!1,this.BC=0,this.YC=0,this.GC=0,this.WC=0,this.qC=0,this.XC=0,this.Dr=0,this.KC=0,this.ZC=0,this.JC=0,this.QC=0}onTouchStart(t){const{touches:i}=t;return!!(this.jk&&i&&i.length>1)||!(!i||1!=i.length)&&(this.Dr=Date.now(),this.BC=i[0].clientX,this.YC=i[0].clientY,!0)}onTouchMove(t){const{touches:i}=t;if(i&&i.length>=1){const{clientX:s,clientY:h}=i[0];if(this.GC=s,this.WC=h,this.jk)this.tz(!1,!1,t);else{const t=Math.abs(s-this.BC),i=Math.abs(h-this.YC);if(this.FC&&this.HC)(t>=8||i>=8)&&this.signalReady(-10);else if(this.FC){if(t>=8&&t>i)this.signalReady(-10);else if(i>=8)return!1}else{if(!this.HC)return!1;if(i>=8&&i>t)this.signalReady(-10);else if(t>=8)return!1}}return!0}return!1}onTouchEnd(t){const{touches:i}=t;i&&0==i.length&&this.iz(t)}acceptStart(){this.jk=!0,this.qC=this.BC,this.XC=this.YC,this.ZC=this.Dr,this.BC=this.GC,this.YC=this.WC,this.tz(!0,!1,null)}acceptCancel(){this.jk=!1}tz(t,i,s){this.KC=Date.now();const h=this.KC-this.ZC;if(!i&&h>4||i&&h>16){const t=pt(this.GC-this.qC,h,this.JC),s=pt(this.WC-this.XC,h,this.QC);(!i||h>32||0!=t||0!=s)&&(this.JC=Math.abs(t)>1e-4?t:0,this.QC=Math.abs(s)>1e-4?s:0),this.qC=this.GC,this.XC=this.WC,this.ZC=this.KC}this.signalEmit({first:t,last:i,time:this.KC,deltaX:this.GC-this.BC,deltaY:this.WC-this.YC,startX:this.BC,startY:this.YC,lastX:this.GC,lastY:this.WC,velocityX:this.JC,velocityY:this.QC},s)}iz(t){this.jk&&(this.jk=!1,this.tz(!1,!0,t),this.signalEnd())}},Et=class extends vt{constructor(t){super("swipe-xy",t,!0,!0)}},bt=class extends ft{constructor(t){super("tapzoom",t),this.jk=!1,this.BC=0,this.YC=0,this.GC=0,this.WC=0,this.MD=0,this.qC=0,this.XC=0,this.KC=0,this.ZC=0,this.JC=0,this.QC=0}onTouchStart(t){if(this.jk)return!1;const{touches:i}=t;return!(!i||1!=i.length||(this.BC=i[0].clientX,this.YC=i[0].clientY,0))}onTouchMove(t){const{touches:i}=t;if(i&&1==i.length){if(this.GC=i[0].clientX,this.WC=i[0].clientY,this.jk)this.tz(!1,!1,t);else{const t=Math.abs(this.GC-this.BC)>=8,i=Math.abs(this.WC-this.YC)>=8;if(t||i){if(0==this.MD)return this.acceptCancel(),!1;this.signalReady(0)}}return!0}return!1}onTouchEnd(t){this.jk?this.iz(t):(this.MD++,1!=this.MD?this.acceptCancel():this.signalPending(400))}acceptStart(){this.MD=0,this.jk=!0,this.tz(!0,!1,null)}acceptCancel(){this.MD=0,this.jk=!1}tz(t,i,s){this.KC=Date.now(),t?this.JC=this.QC=0:this.KC-this.ZC>2&&(this.JC=pt(this.GC-this.qC,this.KC-this.ZC,this.JC),this.QC=pt(this.WC-this.XC,this.KC-this.ZC,this.QC)),this.qC=this.GC,this.XC=this.WC,this.ZC=this.KC,this.signalEmit({first:t,last:i,centerClientX:this.BC,centerClientY:this.YC,deltaX:this.GC-this.BC,deltaY:this.WC-this.YC,velocityX:this.JC,velocityY:this.QC},s)}iz(t){this.jk&&(this.jk=!1,this.tz(!1,!0,t),this.signalEnd())}},Tt=new Set(["amp-img","amp-anim","img"]),It=["aria-label","aria-describedby","aria-labelledby"],Rt=c(.4,0,.2,1),Vt=c(.4,0,.2,1),wt=c(.4,0,.2,1.4),yt=class extends t.BaseElement{constructor(t){super(t),this.SY=-1,this.YK=!1,this.ZK=!1,this.LK=null,this.NK=null,this.UK=null,this.cb=null,this.GK=null,this.HK=null,this.WK=this.qK.bind(this),this.registerDefaultAction((t=>this.q$(t)),"open")}buildCallback(){var t;(t=this.element,function(t,i){const s=K(J(t));return tt(s,i)?Q(s,i):null}(t,"action")).addToAllowlist("AMP-IMAGE-LIGHTBOX","open",["email"])}JK(){if(this.cb)return;this.cb=this.element.ownerDocument.createElement("div"),this.cb.classList.add("i-amphtml-image-lightbox-container"),this.element.appendChild(this.cb),this.GK=new class{constructor(t,i,s){this.KK=t,this.win=i,this.Li=s,this.Sn=t.element.ownerDocument.createElement("div"),this.Sn.classList.add("i-amphtml-image-lightbox-viewer"),this.QK=t.element.ownerDocument.createElement("img"),this.QK.classList.add("i-amphtml-image-lightbox-viewer-image"),this.Sn.appendChild(this.QK),this.t0=null,this.ZD=0,this.GD=0,this.i0=M(0,0,0,0),this.s0=M(0,0,0,0),this.$D=1,this.BD=1,this.h0=1,this.UD=1,this.WD=2,this.BC=0,this.YC=0,this.KD=0,this.QD=0,this.tX=0,this.sX=0,this.iX=0,this.hX=0,this.eX=null,this.CX()}getElement(){return this.Sn}getImage(){return this.QK}getViewerBox(){return this.i0}getImageBox(){return this.s0}getImageBoxWithOffset(){return 0==this.KD&&0==this.QD?this.s0:(t=this.s0,i=this.KD,s=this.QD,0==i&&0==s||0==t.width&&0==t.height?t:M(t.left+i,t.top+s,t.width,t.height));var t,i,s}reset(){this.QK.setAttribute("src",""),It.forEach((t=>{this.QK.removeAttribute(t)})),this.QK.removeAttribute("aria-describedby"),this.t0=null,this.s0=M(0,0,0,0),this.ZD=0,this.GD=0,this.h0=1,this.$D=1,this.BD=1,this.WD=2,this.BC=0,this.YC=0,this.KD=0,this.QD=0,this.tX=0,this.sX=0,this.iX=0,this.hX=0,this.eX&&this.eX.halt(),this.eX=null}n0(t,i){i?(this.ZD=i.naturalWidth||t.offsetWidth,this.GD=i.naturalHeight||t.offsetHeight):(this.ZD=t.offsetWidth,this.GD=t.offsetHeight)}init(t,i){this.n0(t,i),this.t0=function(t){const i=t.getAttribute("srcset");if(i)return function(t){const i=[];let s;for(;s=b.exec(t);){const t=s[1];let h,n;if(s[2]){const t=s[3].toLowerCase();if("w"==t)h=parseInt(s[2],10);else{if("x"!=t)continue;n=parseFloat(s[2])}}else n=1;i.push({url:t,width:h,dpr:n})}return new T(i)}(i);const s=t.getAttribute("src");return p(s,'Either non-empty "srcset" or "src" attribute must be specified: %s',t),new T([{url:s,width:void 0,dpr:1}])}(t),"img"===t.tagName.toLowerCase()?v(It,t,this.QK):t.getImpl().then((t=>v(It,t.element,this.QK))),i&&at(i)&&i.src&&this.QK.setAttribute("src",i.src)}measure(){this.i0=P(this.Sn.getBoundingClientRect());const t=this.ZD/this.GD;let i=Math.min(this.i0.width/t,this.i0.height),s=Math.min(this.i0.height*t,this.i0.width);Math.abs(s-this.ZD)<=16&&Math.abs(i-this.GD)<=16&&(s=this.ZD,i=this.GD),this.s0=M(Math.round((this.i0.width-s)/2),Math.round((this.i0.height-i)/2),Math.round(s),Math.round(i)),D(this.QK,{top:k(this.s0.top),left:k(this.s0.left),width:k(this.s0.width),height:k(this.s0.height)});const h=this.i0.width/this.i0.height,n=Math.max(h/t,t/h);return this.WD=Math.max(2,n),this.BD=this.$D=1,this.BC=this.KD=0,this.YC=this.QD=0,this.AX(this.$D),this.zX(),this._A()}_A(){if(!this.t0)return s();this.h0=Math.max(this.h0,this.$D);const t=this.s0.width*this.h0,i=this.t0.select(t,class{static getTop(t){return t.top}static getLocation(t){return t.location}static getDocumentReferrer(t){return t.document.referrer}static getHostname(t){return t.location.hostname}static getUserAgent(t){return t.navigator.userAgent}static getUserLanguage(t){return t.navigator.userLanguage||t.navigator.language}static getDevicePixelRatio(){return self.devicePixelRatio||1}static getSendBeacon(t){if(t.navigator.sendBeacon)return t.navigator.sendBeacon.bind(t.navigator)}static getXMLHttpRequest(t){return t.XMLHttpRequest}static getImage(t){return t.Image}}.getDevicePixelRatio());return i==this.QK.getAttribute("src")?s():st(this.win).promise(1).then((()=>(this.QK.setAttribute("src",i),this.Li(this.QK))))}CX(){const t=lt.get(this.QK);t.onGesture(Mt,(()=>{this.KK.toggleViewMode()})),t.onGesture(Et,(t=>{this.YX(t.data.deltaX,t.data.deltaY,!1),t.data.last&&this.jX(t.data.velocityX,t.data.velocityY)})),t.onPointerDown((()=>{this.eX&&this.eX.halt()})),t.onGesture(Pt,(t=>{let i;i=1==this.$D?this.WD:this.UD;const s=this.i0.width/2-t.data.clientX,h=this.i0.height/2-t.data.clientY;this.tY(i,s,h,!0).then((()=>this.mX(0,0,0,0,0,0)))})),t.onGesture(bt,(t=>{this.e0(t.data.centerClientX,t.data.centerClientY,t.data.deltaX,t.data.deltaY),t.data.last&&this.mX(t.data.centerClientX,t.data.centerClientY,t.data.deltaX,t.data.deltaY,t.data.velocityY,t.data.velocityY)}))}$X(t,i){return B(t,this.UD,this.WD,i?.25:0)}MX(t,i){return B(t,this.tX,this.iX,i&&this.$D>1?.25*this.i0.width:0)}dX(t,i){return B(t,this.sX,this.hX,i?.25*this.i0.height:0)}AX(t){let i=0,s=0;const h=this.i0.height-this.s0.height*t;h>=0?s=i=0:(s=h/2,i=-s);let n=0,e=0;const r=this.i0.width-this.s0.width*t;r>=0?e=n=0:(e=r/2,n=-e),this.tX=e,this.sX=s,this.iX=n,this.hX=i}zX(){D(this.QK,{transform:X(this.KD,this.QD)+" "+O(this.$D)}),1!=this.$D&&this.KK.toggleViewMode(!0)}YX(t,i,s){const h=this.MX(this.BC+t,!0),n=this.dX(this.YC+i,!0);this.pX(this.$D,h,n,s)}jX(t,i){const s=this.QD-this.YC;1==this.$D&&Math.abs(s)>10?this.KK.close():(this.eX=gt(this.QK,this.KD,this.QD,t,i,((t,i)=>{const s=this.MX(t,!0),h=this.dX(i,!0);return!(Math.abs(s-this.KD)<1&&Math.abs(h-this.QD)<1||(this.pX(this.$D,s,h,!1),0))})),this.eX.thenAlways((()=>(this.eX=null,this.OX()))))}e0(t,i,s,h){const n=U(s,h),e=Math.abs(h)>Math.abs(s)?Math.sign(h):Math.sign(-s);if(0==e)return;const r=this.BD*(1+e*n/100),o=this.i0.width/2-t,a=this.i0.height/2-i;s=Math.min(o,o*(n/100)),h=Math.min(a,a*(n/100)),this.tY(r,s,h,!1)}tY(t,i,s,h){const n=this.$X(t,!0);if(n==this.$D)return;this.AX(n);const e=this.MX(this.BC+i*n,!1),r=this.dX(this.YC+s*n,!1);return this.pX(n,e,r,h)}mX(t,i,h,n,e,r){let o;o=0==e&&0==r?s():gt(this.QK,h,n,e,r,((s,h)=>(this.e0(t,i,s,h),!0))).thenAlways();const a=this.$D>this.BD;return o.then((()=>this.OX())).then((()=>{a&&this._A()}))}pX(t,i,h,n){const e=t-this.$D,r=(o=this.KD,a=this.QD,U(i-o,h-a));var o,a;let c,u=0;if(n){const t=250;u=Math.min(t,Math.max(t*r*.01,t*Math.abs(e)))}if(u>16&&n){const s=$(this.$D,t),n=$(this.KD,i),e=$(this.QD,h);c=rt.animate(this.QK,(t=>{this.$D=s(t),this.KD=n(t),this.QD=e(t),this.zX()}),u,wt).thenAlways((()=>{this.$D=t,this.KD=i,this.QD=h,this.zX()}))}else this.$D=t,this.KD=i,this.QD=h,this.zX(),c=n?s():void 0;return c}OX(){const t=this.$X(this.$D,!1);t!=this.$D&&this.AX(t);const i=this.MX(this.KD/this.$D*t,!1),s=this.dX(this.QD/this.$D*t,!1);return this.pX(t,i,s,!0).then((()=>{this.BD=this.$D,this.BC=this.KD,this.YC=this.QD}))}}(this,this.win,this.loadPromise.bind(this)),this.cb.appendChild(this.GK.getElement()),this.HK=this.element.ownerDocument.createElement("div"),this.HK.setAttribute("id",this.element.getAttribute("id")+"-caption"),this.HK.classList.add("amp-image-lightbox-caption"),this.HK.classList.add("i-amphtml-image-lightbox-caption"),this.cb.appendChild(this.HK);const t=this.element.ownerDocument.createElement("button"),i=this.element.getAttribute("data-close-button-aria-label")||"Close the lightbox";t.textContent=i,t.classList.add("i-amphtml-screen-reader"),t.tabIndex=-1,t.addEventListener("click",(()=>{this.close()})),this.element.appendChild(t);const h=lt.get(this.element);this.element.addEventListener("click",(t=>{this.ZK||this.GK.getImage().contains(t.target)||this.close()})),h.onGesture(Mt,(()=>{this.ZK||this.close()})),h.onGesture(Et,(()=>{}))}q$(t){if(this.YK)return;this.JK();const i=t.caller,s=i.tagName.toLowerCase();var h,n;h=i&&Tt.has(s),n=i.tagName,(G.user||(G.user=H()),void G.user.win?G.userForEmbed||(G.userForEmbed=H()):G.user).assert(h,"Unsupported element: %s",n,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined),this.YK=!0,this.Ie(),this.hl(i),this.win.document.documentElement.addEventListener("keydown",this.WK),this.getViewport().enterLightboxMode(),this.Nv(),this.UK=this.getViewport().onChanged((()=>{var t;this.YK&&((t=this.win,q(t,"platform")).getIosVersionString().startsWith("10.3")?st(this.win).delay((()=>{this.GK.measure()}),500):this.GK.measure())})),this.jK().push(this.close.bind(this)).then((t=>{this.SY=t}))}qK(t){"Escape"==t.key&&(t.preventDefault(),this.close())}close(){this.YK&&(this.YK=!1,this.ZK=!1,this.Wv(),this.UK&&(this.UK(),this.UK=null),this.getViewport().leaveLightboxMode(),-1!=this.SY&&this.jK().pop(this.SY),this.win.document.documentElement.removeEventListener("keydown",this.WK),this.LK&&function(t){try{t.focus()}catch(t){}}(this.LK))}toggleViewMode(t){void 0!==t?this.cb.classList.toggle("i-amphtml-image-lightbox-view-mode",t):this.cb.classList.toggle("i-amphtml-image-lightbox-view-mode")}hl(t){var i;this.LK=t,this.NK=(i=t,A("img"),i.querySelector("> img".replace(/^|,/g,"$&:scope "))),this.GK.init(this.LK,this.NK);let s=null;const h=t.closest("figure");if(h&&(n=h,A(e="figcaption"),s=n.querySelector(e)),!s){const i=t.getAttribute("aria-describedby");s=this.element.ownerDocument.getElementById(i)}var n,e;s&&(function(t,i){const s=i.ownerDocument.createDocumentFragment();for(let i=t.firstChild;i;i=i.nextSibling)s.appendChild(i.cloneNode(!0));i.appendChild(s)}(s,this.HK),this.GK.getImage().setAttribute("aria-describedby",this.HK.getAttribute("id"))),this.HK.classList.toggle("i-amphtml-empty",!s)}Ie(){this.GK.reset(),function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(this.HK),this.LK=null,this.NK=null,this.toggleViewMode(!1)}Nv(){var t,i;this.ZK=!0,t=this.element,void 0===(i=!0)&&(i=t.hasAttribute("hidden")),i?t.removeAttribute("hidden"):t.setAttribute("hidden",""),D(this.element,{opacity:0}),this.GK.measure();const s=new rt(this.element);s.add(0,z(this.element,{opacity:$(0,1)}),.6,Rt);let h=null;if(this.NK&&at(this.NK)&&this.NK.src){h=this.element.ownerDocument.createElement("div"),h.classList.add("i-amphtml-image-lightbox-trans"),this.getAmpDoc().getBody().appendChild(h);const t=P(this.NK.getBoundingClientRect()),i=this.GK.getImageBox(),n=this.NK.cloneNode(!0);n.className="",D(n,{position:"absolute",top:k(t.top),left:k(t.left),width:k(t.width),height:k(t.height),transformOrigin:"top left",willChange:"transform"}),h.appendChild(n),this.NK.classList.add("i-amphtml-ghost");const e=i.left-t.left,r=i.top-t.top,o=0!=t.width?i.width/t.width:1,a=N(Math.abs(r)/250*.8,.2,.8);s.add(0,z(n,{transform:Y([Z($(0,e),$(0,r)),L($(1,o))])}),a,Rt),D(this.cb,{opacity:0}),s.add(.8,z(this.cb,{opacity:$(0,1)}),.1,Rt),s.add(.9,z(h,{opacity:$(1,.01)}),.1,Vt)}return s.start(500).thenAlways((()=>{this.ZK=!1,D(this.element,{opacity:""}),D(this.cb,{opacity:""}),h&&this.getAmpDoc().getBody().removeChild(h)}))}Wv(){const t=this.GK.getImage(),i=this.GK.getImageBoxWithOffset(),s=new rt(this.element);let h=500;s.add(0,z(this.element,{opacity:$(1,0)}),.9,Vt);let n=null;if(at(t)&&t.src&&this.NK){n=this.element.ownerDocument.createElement("div"),n.classList.add("i-amphtml-image-lightbox-trans"),this.getAmpDoc().getBody().appendChild(n);const e=P(this.NK.getBoundingClientRect()),r=t.cloneNode(!0);D(r,{position:"absolute",top:k(i.top),left:k(i.left),width:k(i.width),height:k(i.height),transform:"",transformOrigin:"top left",willChange:"transform"}),n.appendChild(r),s.add(0,z(this.cb,{opacity:$(1,0)}),.1,Vt);const o=e.left-i.left,a=e.top-i.top,c=0!=i.width?e.width/i.width:1,u=z(r,{transform:Y([Z($(0,o),$(0,a)),L($(1,c))])}),l=N(Math.abs(a)/250*.8,.2,.8);s.add(Math.min(.8-l,.2),((t,i)=>{u(t),i&&this.NK.classList.remove("i-amphtml-ghost")}),l,Vt),s.add(.8,z(n,{opacity:$(1,.01)}),.2,Vt),h=N(Math.abs(a)/250*h,300,h)}return s.start(h).thenAlways((()=>{this.NK&&this.NK.classList.remove("i-amphtml-ghost"),this.collapse(),D(this.element,{opacity:""}),D(this.cb,{opacity:""}),n&&this.getAmpDoc().getBody().removeChild(n),this.Ie()}))}jK(){return function(t,i){return Q(K(J(t)),"history")}(this.getAmpDoc())}};t.registerElement("amp-image-lightbox",yt,"amp-image-lightbox{position:fixed!important;top:0!important;left:0!important;bottom:0!important;right:0!important;margin:0!important;padding:0!important;overflow:hidden!important;transform:translateZ(0)!important;-ms-touch-action:none!important;touch-action:none!important;z-index:1000;background:rgba(0,0,0,0.95);color:#f2f2f2}.i-amphtml-image-lightbox-container{position:absolute;z-index:0;top:0;left:0;right:0;bottom:0;overflow:hidden;transform:translateZ(0)}.i-amphtml-image-lightbox-trans{pointer-events:none!important;position:fixed;z-index:1001;top:0;left:0;bottom:0;right:0}.i-amphtml-image-lightbox-caption{position:absolute!important;z-index:2;bottom:0!important;left:0!important;right:0!important}.i-amphtml-image-lightbox-caption.i-amphtml-empty,.i-amphtml-image-lightbox-view-mode .i-amphtml-image-lightbox-caption{visibility:hidden}.amp-image-lightbox-caption{background:rgba(0,0,0,0.5);max-height:25%;padding:8px}.i-amphtml-image-lightbox-viewer{position:absolute;z-index:1;top:0;left:0;right:0;bottom:0;overflow:hidden;transform:translateZ(0)}.i-amphtml-image-lightbox-viewer-image{position:absolute;z-index:1;display:block;transform-origin:50% 50%}\n/*# sourceURL=/extensions/amp-image-lightbox/0.1/amp-image-lightbox.css*/")})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-image-lightbox-0.1.mjs.map